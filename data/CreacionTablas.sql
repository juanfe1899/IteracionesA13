--- Sentencias SQL para la creaciÓn del esquema SuperAndes

--Creación del secuenciador para generar valores únicos
CREATE SEQUENCE SUPERANDES_SEQUENCE;

--Creación de la tabla CATEGORIAS y especificación de sus restricciones
CREATE TABLE CATEGORIAS(
ID INT NOT NULL,
NOMBRE VARCHAR(255) NOT NULL,
--Restricciones sobre la tabla
CONSTRAINT PK_CATEGORIA PRIMARY KEY (ID)
);

--Creación de la tabla SUPERMERCADOS y especificación de sus restricciones
CREATE TABLE SUPERMERCADOS(
NIT NUMBER NOT NULL,
NOMBRE VARCHAR(255) NOT NULL,

--Restricciones sobre la tabla
CONSTRAINT PK_SUPERMERCADO PRIMARY KEY (NIT)
);

--Creación de la tabla SUCURSALES y especificación de sus restricciones
CREATE TABLE SUCURSALES(
ID NUMBER NOT NULL,
CIUDAD VARCHAR(255) NOT NULL,
DIRECCION VARCHAR(255) NOT NULL,
NOMBRE VARCHAR(255) NOT NULL,
NIT_SUPERMERCADO NUMBER NOT NULL,

--Restricciones sobre la tabla
CONSTRAINT PK_SUCURSAL PRIMARY KEY (ID),
CONSTRAINT FK_SUPERMERCADO_SUCURSAL FOREIGN KEY (NIT_SUPERMERCADO) REFERENCES SUPERMERCADOS(NIT)
);

--Creación de la tabla PRODUCTOS y especificación de sus restricciones
CREATE TABLE PRODUCTOS(
CODIGO VARCHAR2(255) NOT NULL,
NOMBRE VARCHAR(255) NOT NULL,
MARCA VARCHAR(255) NOT NULL,
PRESENTACION VARCHAR(255) NOT NULL,
UNIDAD_MEDIDA VARCHAR(255) NOT NULL,
CANTIDAD_EN_PRESENTACION NUMBER NOT NULL,
ESPECIFICACION_EMPACADO NUMBER NOT NULL,
CATEGORIA NUMBER NOT NULL,
--Restricciones sobre la tabla
CONSTRAINT PK_PRODUCTO PRIMARY KEY (CODIGO),
CONSTRAINT FK_CATEGORIA_PRODUCTO FOREIGN KEY (CATEGORIA) REFERENCES CATEGORIAS(ID),
CONSTRAINT CHK_ESPECIFICACION_EMPACADO CHECK (ESPECIFICACION_EMPACADO >0),
CONSTRAINT CHK_CANTIDAD_PRODUCTO CHECK (CANTIDAD_EN_PRESENTACION >0)
);

--Creación de la tabla PROVEEDORES y especificación de sus restricciones
CREATE TABLE PROVEEDORES(
NIT NUMBER NOT NULL,
NOMBRE VARCHAR(255) NOT NULL,
CALIFICACION NUMBER NOT NULL,
--Restricciones sobre la tabla
CONSTRAINT PK_PROVEEDORES PRIMARY KEY (NIT),
CONSTRAINT CHK_CALIFICACION CHECK (CALIFICACION BETWEEN 0 AND 10)
);

--Creación de la tabla PROVEEN y especificación de sus restricciones
CREATE TABLE PROVEEN(
ID_PROVEEDOR NUMBER NOT NULL,
ID_PRODUCTO VARCHAR2(255) NOT NULL,
PRECIO_CU NUMBER NOT NULL,
PRECIO_UNIDAD_MEDIDA NUMBER NOT NULL,
--Restricciones sobre la tabla
CONSTRAINT PK_PROVEE PRIMARY KEY (ID_PROVEEDOR, ID_PRODUCTO),
CONSTRAINT FK_PRODUCTO_PROVEEN FOREIGN KEY (ID_PRODUCTO) REFERENCES PRODUCTOS(CODIGO),
CONSTRAINT FK_PROVEEDOR_PROVEEN FOREIGN KEY (ID_PROVEEDOR) REFERENCES PROVEEDORES(NIT),
CONSTRAINT CHK_PRECIO_CU CHECK (PRECIO_CU >0),
CONSTRAINT CHK_PRECIO_UNIDAD_MEDIDA CHECK (PRECIO_UNIDAD_MEDIDA >0)
);

--Creación de la tabla PRODUCTOS_SUCURSAL y especificación de sus restricciones
CREATE TABLE PRODUCTOS_SUCURSAL(
ID NUMBER NOT NULL,
ID_PRODUCTO VARCHAR2(255) NOT NULL,
ID_SUCURSAL NUMBER NOT NULL,
CANTIDAD_REORDER NUMBER NOT NULL,
PRECIO_CU NUMBER NOT NULL,

--Restricciones sobre la tabla
CONSTRAINT PK_PRODUCTO_SUCURSAL PRIMARY KEY (ID),
CONSTRAINT FK_PRODUCTO_PRODUCTO_SUCURSAL FOREIGN KEY (ID_PRODUCTO) REFERENCES PRODUCTOS(CODIGO),
CONSTRAINT FK_PROD_SUC FOREIGN KEY (ID_SUCURSAL) REFERENCES SUCURSALES(ID)
);

--Creación de la tabla PROMOCIONES y especificación de sus restricciones
CREATE TABLE PROMOCIONES(
ID NUMBER NOT NULL,
FECHA_INICIO DATE NOT NULL,
FECHA_FINAL DATE NOT NULL,
TIPO VARCHAR(255) NOT NULL,
UNIDADES_DISPONIBLES NUMBER NOT NULL,
--Restricciones sobre la tabla
CONSTRAINT PK_PROMOCIONES PRIMARY KEY (ID),
CONSTRAINT CHK_FECHA CHECK(FECHA_FINAL > FECHA_INICIO)
);

--Creación de la tabla OFRECEN y especificación de sus restricciones
CREATE TABLE OFRECEN(
ID_SUPERMERCADO NUMBER NOT NULL,
ID_PRODUCTO VARCHAR2(255) NOT NULL,
PRECIO_CU NUMBER NOT NULL,
PRECIO_UNIDAD_MEDIDA NUMBER NOT NULL,

--Restricciones de la tabla

CONSTRAINT PK_OFRECEN PRIMARY KEY (ID_SUPERMERCADO, ID_PRODUCTO),
CONSTRAINT FK_SUPERMERCADO_OFRECEN FOREIGN KEY (ID_SUPERMERCADO) REFERENCES SUPERMERCADOS(NIT),
CONSTRAINT FK_PRODUCTO_OFRECEN FOREIGN KEY (ID_PRODUCTO) REFERENCES PRODUCTOS(CODIGO),
CONSTRAINT CHK_PRECIO_CU_OFRECE CHECK(PRECIO_CU > 0),
CONSTRAINT CHK_PRECIO_UN_OFRECE CHECK(PRECIO_UNIDAD_MEDIDA > 0)
);

--Creación de la tabla SUPERMERCADO_PROVEEDORES y especificación de sus restricciones
CREATE TABLE SUPERMERCADO_PROVEEDORES(
ID_SUPERMERCADO NUMBER NOT NULL,
ID_PROVEEDOR NUMBER NOT NULL,

--Restricciones sobre la tabla
CONSTRAINT PK_SUPER_PROVEEDOR PRIMARY KEY (ID_SUPERMERCADO, ID_PROVEEDOR),
CONSTRAINT FK_SUPER_SUPER_PROVEEDOR FOREIGN KEY (ID_SUPERMERCADO) REFERENCES SUPERMERCADOS(NIT),
CONSTRAINT FK_PROVEED_SUPER_PROVEEDOR FOREIGN KEY (ID_PROVEEDOR) REFERENCES PROVEEDORES(NIT)
);

--Creación de la tabla PEDIDOS_SUCURSAL y especificación de sus restricciones
CREATE TABLE PEDIDOS_SUCURSAL(
ID NUMBER NOT NULL,
ID_SUCURSAL NUMBER NOT NULL,
ID_PROVEEDOR NUMBER NOT NULL,
ESTADO VARCHAR(30) NOT NULL,
FECHA_ESPERADA DATE NOT NULL,
FECHA_ENTREGA DATE,
CALIFICACION NUMBER NOT NULL,

--Restricciones sobre la tabla
CONSTRAINT PK_PEDIDOS PRIMARY KEY (ID),
CONSTRAINT FK_SUCURSAL_PEDIDOS FOREIGN KEY (ID_SUCURSAL) REFERENCES SUCURSALES(ID),
CONSTRAINT FK_PROVEEDOR_PEDIDOS FOREIGN KEY (ID_PROVEEDOR) REFERENCES PROVEEDORES(NIT),
CONSTRAINT CHK_ESTADO_PEDIDOS CHECK(ESTADO IN ('EN_ESPERA', 'ENTREGADO')),
CONSTRAINT CHK_CALIFICACION_PEDIDOS CHECK (CALIFICACION BETWEEN 0 AND 10)
);

--Creación de la tabla ORDEN_PRODUCTOS y especificación de sus restricciones
CREATE TABLE ORDEN_PRODUCTOS(
ID_PEDIDO NUMBER NOT NULL,
ID_PRODUCTO VARCHAR2(255) NOT NULL,
PRECIO_CU_ACORDADO NUMBER NOT NULL,
CANTIDAD NUMBER NOT NULL,

--Restricciones sobre la tabla
CONSTRAINT PK_ORDEN PRIMARY KEY (ID_PEDIDO, ID_PRODUCTO),
CONSTRAINT FK_PEDIDO_ORDEN FOREIGN KEY (ID_PEDIDO) REFERENCES PEDIDOS_SUCURSAL (ID),
CONSTRAINT FK_PRODUCTO_ORDEN FOREIGN KEY (ID_PRODUCTO) REFERENCES PRODUCTOS(CODIGO),
CONSTRAINT CHK_PRECIO_ACORDADO CHECK (PRECIO_CU_ACORDADO > 0),
CONSTRAINT CHK_CANTIDAD CHECK (CANTIDAD > 0)
);

--Creación de la tabla CLIENTES y especificación de sus restricciones
CREATE TABLE CLIENTES(
ID NUMBER NOT NULL,
NOMBRE VARCHAR(255) NOT NULL,
CORREO NVARCHAR2(255) NOT NULL,
DIRECCION NVARCHAR2(255),
NUM_IDENTIFICACION NUMBER NOT NULL,
TIPO_IDENTIFICACION VARCHAR2(255),
USUARIO VARCHAR(255) NOT NULL,
CONTRASENHA VARCHAR(255) NOT NULL,


--Restricciones de la tabla
CONSTRAINT PK_CLIENTE PRIMARY KEY (ID),
CONSTRAINT CHK_NUM_IDENTI CHECK (NUM_IDENTIFICACION > 0),
CONSTRAINT CHK_CORREO CHECK (CORREO LIKE '%@%'),
CONSTRAINT FK_ID_CARRITO FOREIGN KEY(ID_CARRITO) REFERENCES CARRITO_COMPRAS(ID)
);

--Creación de la tabla FACTURAS y especificación de sus restricciones
CREATE TABLE FACTURAS(
ID NUMBER NOT NULL,
FECHA DATE NOT NULL,
TOTAL NUMBER NOT NULL,
ID_CLIENTE NUMBER NOT NULL,
ID_SUCURSAL NUMBER NOT NULL,

--Restricciones de la tabla
CONSTRAINT PK_FACTURA PRIMARY KEY (ID),
CONSTRAINT FK_CLIENTE_FACTURA FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTES(ID),
CONSTRAINT FK_SUCURSAL_FACTURA FOREIGN KEY (ID_SUCURSAL) REFERENCES SUCURSALES(ID),
CONSTRAINT CHK_TOTAL CHECK (TOTAL > 0)
);

--Creación de la tabla VENTAS_PRODUCTO y especificación de sus restricciones
CREATE TABLE VENTAS_PRODUCTO(
ID_PRODUCTO_SUC NUMBER NOT NULL,
ID_FACTURA NUMBER NOT NULL,
CANTIDAD NUMBER NOT NULL,

--Restricciones tabla
CONSTRAINT PK_VENTAS PRIMARY KEY (ID_PRODUCTO_SUC, ID_FACTURA),
CONSTRAINT FK_PRODUCTO_SUC_VENTA FOREIGN KEY (ID_PRODUCTO_SUC) REFERENCES PRODUCTOS_SUCURSAL(ID),
CONSTRAINT FK_FACTURA_VENTA FOREIGN KEY (ID_FACTURA) REFERENCES FACTURAS(ID),
CONSTRAINT CHK_CANTIDAD_VENTA CHECK (CANTIDAD > 0)
);

--Creación de la tabla ESPACIO_ACOMODACION y especificación de sus restricciones
CREATE TABLE ESPACIO_ACOMODACION(
ID NUMBER NOT NULL,
TIPO VARCHAR(30) NOT NULL,
VOLUMEN_MAXIMO NUMBER NOT NULL,
VOLUMEN_MINIMO NUMBER NOT NULL,
ID_CATEGORIA NUMBER NOT NULL,
ID_SUCURSAL NUMBER NOT NULL,

--Restricciones sobre la tabla
CONSTRAINT PK_ESPACIO_ACO PRIMARY KEY (ID),
CONSTRAINT FK_CATEGORIA_ESPA FOREIGN KEY (ID_CATEGORIA) REFERENCES CATEGORIAS(ID),
CONSTRAINT FK_SUCURSAL_ESPACIO FOREIGN KEY (ID_SUCURSAL) REFERENCES SUCURSALES(ID),
CONSTRAINT CHK_TIPO_ESPACIO CHECK (TIPO IN ('BODEGA', 'ESTANTE')),
CONSTRAINT CHK_VOLUMEN_ESPACIO CHECK (VOLUMEN_MAXIMO > VOLUMEN_MINIMO AND VOLUMEN_MINIMO > 0)
);

--Creación de la tabla EXISTENCIAS y especificación de sus restricciones
CREATE TABLE EXISTENCIAS(
ID_PRODUCTO_SUC NUMBER NOT NULL,
ID_ESPACIO_ACOMO NUMBER NOT NULL,
CANTIDAD NUMBER NOT NULL,

CONSTRAINT PK_EXISTENCIAS PRIMARY KEY (ID_PRODUCTO_SUC, ID_ESPACIO_ACOMO),
CONSTRAINT FK_PRODUC_SUC_EXIST FOREIGN KEY (ID_PRODUCTO_SUC) REFERENCES PRODUCTOS_SUCURSAL(ID),
CONSTRAINT FK_ESPACIO_EXISTENCIAS FOREIGN KEY (ID_ESPACIO_ACOMO) REFERENCES ESPACIO_ACOMODACION(ID),
CONSTRAINT CHK_CANTIDAD_EXISTENCIAS CHECK (CANTIDAD > 0)
);

CREATE TABLE PRODUCTOS_PROMOCION (
    ID_PRODUCTO_SUC NUMBER NOT NULL,
    ID_PROMOCION NUMBER NOT NULL,

    CONSTRAINT PK_PRODUCTO_PROM PRIMARY KEY (ID_PRODUCTO_SUC, ID_PROMOCION),
    CONSTRAINT FK_PROD_PROM FOREIGN KEY (ID_PRODUCTO_SUC) REFERENCES PRODUCTOS_SUCURSAL(ID),
    CONSTRAINT FK_PROMO_PROD_PROM FOREIGN KEY (ID_PROMOCION) REFERENCES PROMOCIONES (ID)
);

CREATE TABLE CARRITO_COMPRAS(
    ID_CARRITO_COMPRAS NUMBER NOT NULL,
    ID_SUCURSAL NUMBER NOT NULL,
    ID_CLIENTE NUMBER NOT NULL,
    TOTAL NUMBER NOT NULL,

    CONSTRAINT PK_CARRITO_SUCURSAL PRIMARY KEY(ID_CARRITO_COMPRAS, ID_SUCURSAL),
    CONSTRAINT FK_SUCURSAL FOREIGN KEY(ID_SUCURSAL) REFERENCES SUCURSALES(ID),
    CONSTRAINT FK_CLIENTE FOREIGN KEY(ID_CLIENTE) REFERENCES CLIENTES(ID),
    CONSTRAINT CHK_TOTAL_VALIDO CHECK (TOTAL >= 0)
);
CREATE TABLE CONTENIDO_CARRITO(
    ID_CARRITO_COMPRAS NUMBER NOT NULL,
    ID_PRODUCTO_SUCURSAL NUMBER NOT NULL,
    CANTIDAD NUMBER NOT NULL,

    CONSTRAINT PK_CARRITO_SUCURSAL PRIMARY KEY(ID_CARRITO_COMPRAS,ID_PRODUCTO_SUCURSAL),
    CONSTRAINT FK_PRODUCTO_SUCURSAL FOREIGN KEY (ID_PRODUCTO_SUCURSAL) REFERENCES PRODUCTOS_SUCURSAL(ID),
    CONSTRAINT CHK_TOTAL_VALIDO CHECK (CANTIDAD > 0)
);



COMMIT;